{% extends '::base.html.twig' %}

{% block javascript %}
<script type="text/javascript">
function filter_redirect()
{
    var ftype = $('#filter_type').val();
    var fusage = $('#filter_usage').val();

    window.location.replace('/client/{{ client_id }}/numbers?usage=' + fusage + '&type=' + ftype);
}

$(document).ready(function() {
    $('#filter_usage').change(filter_redirect);
    $('#filter_type').change(filter_redirect);

    $('.delete_num').click(function() {
        var num_id = $(this).data('id');
        $('#dnum_id').html(num_id);
        $('#dnum_form').attr('action', '/number/' + num_id + '/unassign');
    });
});
</script>
{% endblock %}

{% block body %}
<div class="container-fluid">
    <!-- BEGIN PAGE HEADER-->
    <div class="row-fluid">
        <div class="span12">    
            <h3 class="page-title">
                Number Management 
            </h3>
            <ul class="breadcrumb">
                <li>
                    {{ client.getName }}
                    <i class="icon-angle-right"></i>
                </li>
                <li>
                    Number Management
                </li>
            </ul>

            {{ flash.display_flash_messages }}
            <!--
            <button class="btn green" style="margin-bottom: 4px;"  data-toggle="modal" href="#requestNumbers"><i class="icon-plus"></i> Request More Numbers</button> 
            <br /><br /><br />
            -->

            Filter By Usage:
            <select id="filter_usage" class="small m-wrap" tabindex="1">
                <option value="" {{ (usage is sameas('')) ? 'selected="selected"' : '' }}>-</option>
                <option value="1" {{ (usage is sameas('1')) ? 'selected="selected"' : '' }}>In Use</option>
                <option value="0" {{ (usage is sameas('0')) ? 'selected="selected"' : '' }}>Not In Use</option>
            </select>

            Filter By Type:
            <select id="filter_type" class="small m-wrap" tabindex="1">
                <option value="">-</option>
                {% for value,text in types %}
                    <option value="{{ value }}" {{ (type == value) ? 'selected="selected"' : '' }}>{{ text }}</option>
                {% endfor %}
            </select>
            <br />

            <!-- Add Number MODAL -->
            <form method="post" action="/client/{{ client_id }}/numbers/request">
            <div id="requestNumbers" class="modal hide fade" tabindex="-1" data-width="760">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h3>Request Numbers</h3>
                    <ul>
                        <li>Numbers will be provisioned within 24 hours (Mon-Fri)</li>
                        <li>Numbers will be charged at HKD 29/month (pro rata)</li>
                    </ul>

                </div>
                <div class="modal-body">
                    <div class="row-fluid">
                        <div class="span12">
                            <h4>Number Details</h4>
                            <p>
                                How many phone numbers do you require?*<br />
                                <input name="number" type="text" class="span12 m-wrap">
                            </p>
                            <p>
                                Do you have any special requirements for the numbers?*<br />
                                <textarea name="requirements" class="span12 m-wrap"></textarea>
                            </p>
                        </div>
                    </div>
                </div>
        
                <div class="modal-footer">
                    <button type="button" data-dismiss="modal" class="btn">Cancel</button>
                    <input type="submit" class="btn green" value="Request Numbers" />
                </div>
            </div> 
            </form>
            <!-- End Add Number MODAL -->
            
            <!-- DELETE Number MODAL -->
            <div id="deleteNumber" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h3 id="myModalLabel3">Delete <span id="dnum_id">85266821490</span>?</h3>
                </div>
                <div class="modal-body">
                    <p>Relinquishing a number will permanently remove it from this client account and it will be re-entered into the pool for all CallTracking customers to use. Please note, you will be billed for the remainder of the month for this phone number. Press "Delete Number" to proceed.</p>
                </div>
                <form id="dnum_form" method="post">
                <div class="modal-footer">
                    <button class="btn pull-left green" data-dismiss="modal" aria-hidden="true">Cancel</button>
                    <input type="submit" class="btn red" value="Delete Number" />
                </div>
                </form>
            </div>
            <!-- END Number MODAL -->

            <form id="assign_form" method="post" action="/account/0/numbers">
            <table class="table-bordered table-striped table-condensed cf">
                <thead>
                    <tr>
                        <th style="width:108px;">Number</th>
                        <th>In Use</th>
                        <th>Advert</th>
                        <th>AdGroup</th>
                        <th>Campaign</th>
                        <th>Type</th>
                        <th>Cost/Month (HKD)</th>
                        <th style="width:90px;">Date Added to Client</th>
                        <th>Last Called<br /><small>dd/mm/yy hh:mm</small></th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for num in numbers %}
                    <tr>
                        <td>{{ num.getIDFormatted }}</td>
                        <td>{{ num.isAssigned ? 'Yes' : 'No' }}</td>
                        {% if num.getAdvert %}
                            <td><a href="/adgroup/{{ num.getAdGroup.getID }}/adverts">{{ num.getAdvertFormatted }}</a></td>
                        {% else %}
                            <td>{{ num.getAdvertFormatted }}</td>
                        {% endif %}
                        {% if num.getAdGroup %}
                            <td><a href="/adgroup/{{ num.getAdGroup.getID }}/adverts">{{ num.getAdGroupFormatted }}</a></td>
                        {% else %}
                            <td>{{ num.getAdGroupFormatted }}</td>
                        {% endif %}
                        {% if num.getCampaign %}
                            <td><a href="/campaign/{{ num.getCampaign.getID }}/adgroups">{{ num.getCampaignFormatted }}</a></td>
                        {% else %}
                            <td>{{ num.getCampaignFormatted }}</td>
                        {% endif %}
                        <td>{{ num.getTypeText }}</td>
                        <td>{{ num.getPriceResaleFormatted }}</td>
                        <td>{{ num.getDateAssignFormatted }}</td>
                        <td>{{ num.getDateLastCallFormatted }}</td>
                        <td>
                            {% if (not num.isAssigned) %}
                            <button href="#deleteNumber" data-toggle="modal" data-id="{{ num.getID }}" role="button" class="btn mini delete_num">relinquish</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </form>
        </div>
    </div>
</div>
{% endblock %}
