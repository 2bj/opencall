{% extends '::base.html.twig' %}

{% block javascript %}
<script type="text/javascript">
function filter_redirect()
{
    var ftype = $('#filter_type').val();
    var fusage = $('#filter_usage').val();

    window.location.replace('/numbers?usage=' + fusage + '&type=' + ftype);
}

$(document).ready(function() {
    $('#filter_usage').change(filter_redirect);
    $('#filter_type').change(filter_redirect);

    $('.edit_num').click(function() {
        var num_id = $(this).data('id');
        $('#edit_form').attr('action', '/number/' + num_id);
        $.get('/number/' + num_id, function(num_data) {
            $('#num_id').html(num_data.id);
            $('#num_provider').val(num_data.provider);
            $('#num_type').val(num_data.type);
            $('#num_price_buy').val(num_data.price_buy_formatted);
            $('#num_price_resale').val(num_data.price_resale_formatted);
        }, 'json');
    });

    $('.delete_num').click(function() {
        var num_id = $(this).data('id');
        $('#dnum_id').html(num_id);
        $('#dnum_form').attr('action', '/number/' + num_id + '/delete');
    });

    $('#assign_submit').click(function() {
        var acc_id = $('#assign_acc_id').val();
        $('#assign_form').attr('action', '/account/' + acc_id + '/numbers').submit();
    });
});
</script>
{% endblock %}

{% block body %}
<!-- BEGIN PAGE CONTAINER-->
<div class="container-fluid">
    <!-- BEGIN PAGE HEADER-->
    <div class="row-fluid">
        <div class="span12">    
    
            <h3 class="page-title">
                Number Management 
            </h3>
            {{ flash.display_flash_messages }}
            <form id="assign_form" method="post" action="/account/0/numbers">
            <table class="table-bordered table-striped table-condensed cf">
                <thead>
                    <tr>
                        <th style="width:108px;">Number</th>
                        <th>In Use</th>
                        <th>Advert</th>
                        <th>AdGroup</th>
                        <th>Campaign</th>
                        <th>Client</th>
                        <th>Type</th>
                        <th>Cost/Month (HKD)</th>
                        <th style="width:90px;">Date Added to Client</th>
                        <th>Last Called<br /><small>dd/mm/yy hh:mm</small></th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for num in numbers %}
                    <tr>
                        <td>{{ num.getIDFormatted }}</td>
                        <td>{{ num.isAssigned ? 'Yes' : 'No' }}</td>
                        <td>{{ num.getAdvertFormatted }}</td>
                        <td>{{ num.getAdGroupFormatted }}</td>
                        <td>{{ num.getCampaignFormatted }}</td>
                        <td>{{ num.getClient.getName }}</td>
                        <td>{{ num.getTypeText }}</td>
                        <td>{{ num.getPriceResaleFormatted }}</td>
                        <td>{{ num.getDateAssignFormatted }}</td>
                        <td>{{ num.getDateLastCallFormatted }}</td>
                        <td>
                            <button href="#editNumber" data-toggle="modal" data-id="{{ num.getID }}" role="button" class="btn mini edit_num" ><i class="icon-edit"></i> edit</button>
                            {% if (not num.isInUse) %}
                            <button href="#deleteNumber" data-toggle="modal" data-id="{{ num.getID }}" role="button" class="btn mini delete_num"><i class="icon-trash"></i> delete</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </form>
        </div>
    </div>
</div>
{% endblock %}
